# Task Plan

## 本周优先
- 归档参考项目要点：仅保留有价值的提示词/管线思路到 docs/notes（无需保留代码），其余参考目录可删除。
- 编写 Gemini 图片解析烟囱脚本：批量 20 张样例（含几何题），落盘 JSON+SVG，统计成功率与常见错误。
- 定义导出规范样张：PDF/Word 的题号、分值、行距、公式字体、页边距，生成一版示例供前端/后端对齐。
- 初始化项目骨架：Next.js 教师端（Tiptap+数学公式 demo）、FastAPI 后端（路由骨架、任务队列占位、上传目录），Docker Compose 雏形。
- 后端落地：DB 配置可切换 Postgres，题目/试卷存储与导出接口输出 LaTeX 文本（未编译）。

## 近期（2 周内）
- 数据库迁移初版：User/Question/Paper/PaperTemplate/审核日志/版本号表，pgvector 字段预留 embedding，编写 Alembic 迁移。
- 题库存取 API：上传→AI 分析→审核修改→入库的最小链路（不含复杂权限），并支持列表/搜索。
- 导出服务雏形：LaTeX → PDF 编译（捕获错误日志），Word 用 python-docx 重排版，支持是否含答案/解析的开关。
- SVG 轻量编辑：前端预览+位置微调，后端准备 svg2tikz 转换与回退策略。

## 中期（1 个月内）
- 试卷构建器：模板选择、题目卡槽排序/分组、实时预览，支持从题库检索插入。
- RAG 基线：关键词检索 + 简单向量检索（text-embedding-3-small），返回引用题目 ID/片段，前端展示溯源。
- 监控与日志：AI 调用耗时/错误率、导出失败日志、任务队列监控看板。

## 风险与验证点
- 数学公式/几何双通道一致性：题干/答案的 LaTeX 与 SVG/TikZ 对齐校验，必要时人工审阅。
- SVG 兼容性：生成 SVG 是否能稳定转 TikZ，需收集失败样本优化 Prompt 或转换脚本。
- 性能与体验：大文件上传/解析的耗时与超时策略，前端编辑器在长题目下的性能。
- RAG 幻觉：回答中明确引用来源，保留“AI 生成”标注，支持用户反馈回流训练。
